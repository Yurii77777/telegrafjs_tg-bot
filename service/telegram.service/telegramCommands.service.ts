const { Markup } = require('telegraf');
const axios = require('axios');

import { bot } from '../../config/telegram.config';

import { User } from '../../model/user.model';

import { UserService } from '../user.service';
import { TelegramUtilsService } from '../telegram.service/telegramUtils.service';

import { TELEGRAM_BOT_BTN_ACTIONS } from '../../constants/telegramBotBtnActions';

export class TelegramCommandsService {
  private userService: UserService;
  private telegramUtilsService: TelegramUtilsService;

  constructor() {
    this.userService = new UserService();
    this.telegramUtilsService = new TelegramUtilsService();
  }

  async setBotCommands() {
    bot.telegram.setMyCommands([
      {
        command: '/start',
        description: "–î–ª—è —Å—Ç–∞—Ä—Ç—É | Let's start",
      },
      {
        command: '/set_language',
        description: "–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –º–æ–≤—É –±–æ—Ç–∞ | Set bot's language",
      },
      {
        command: '/update_user',
        description: '–û–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ | Update user',
      },
      {
        command: '/add_post',
        description: '–î–æ–¥–∞—Ç–∏ –ø–æ—Å—Ç | Add post',
      },
      {
        command: '/add_to_google_sheets',
        description: '–ó–∞–ø–∏—Å–∞—Ç–∏ –¥–æ –¢–∞–±–ª–∏—Ü—ñ | Write to the Table',
      },
      {
        command: '/get_from_google_sheets',
        description: '–ó—á–∏—Ç–∞—Ç–∏ –¥–∞–Ω—ñ —ñ–∑ –¢–∞–±–ª–∏—Ü—ñ | Read from the Table',
      },
    ]);
  }

  async handleStartCommand(ctx) {
    // –†–æ–∑–∫–æ–º–µ–Ω—Ç—É–π—Ç–µ —Ä—è–¥–æ–∫ –Ω–∏–∂—á–µ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –¥–∞–Ω—ñ
    // –í–∏–≤–µ–¥—ñ—Ç—å –≤–µ—Å—å ctx, –∞ –Ω–µ –ª–∏—à–µ –≤–∫–ª–∞–¥–µ–Ω—ñ —Å–µ–∫—Ü—ñ—ó
    // console.log('[ctx.update.message in start command]', ctx?.update?.message);

    // –î—ñ—Å—Ç–∞—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –Ω–∞–º –¥–∞–Ω—ñ —ñ–∑ ctx
    // –î–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ id –ø–µ—Ä–µ–π–º–µ–Ω—É—î–º–æ –≤ chatId
    const { id: chatId, first_name, username } = ctx?.update?.message?.chat;

    // –†–æ–±–∏–º–æ –∑–∞–ø–∏—Ç –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –¥–ª—è –ø–æ—à—É–∫—É —Ç–∞–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    let user: null | User = null;

    try {
      user = await this.userService.getUser({ chatId });
    } catch (error) {
      // –Ø–∫—â–æ –º–∏ –ø–æ—Ç—Ä–∞–ø–∏–ª–∏ –≤ –¥–∞–Ω—É —Å–µ–∫—Ü—ñ—é, –∑–Ω–∞—á–∏—Ç—å –∑–∞–ø–∏—Ç –¥–æ –ë–î –≤–ø–∞–≤
      // –ü—Ä–æ —Ü–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å–ø–æ–≤—ñ—Å—Ç–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω —Ç–æ –Ω–µ –∑–Ω–∞—î —Ü—å–æ–≥–æ
      // –î–ª—è —Ü–æ–≥–æ –º–∏ —Å–º–æ—Ç—Ä—é—î–º–æ –æ–∫—Ä–µ–º–∏–π –º–µ—Ç–æ–¥, —â–æ–± –±—É–ª–æ –∑—Ä—É—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
      // –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –æ–±—Ä–∞–Ω–æ—ó –º–æ–≤–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
      // –ê–ª–µ –≤ –¥–∞–Ω–æ–º—É –≤–∏–ø–∞–¥–∫—É, –º–∏ –Ω–µ –∑–Ω–∞–π—à–ª–∏ —é–∑–µ—Ä–∞, —Ç–æ–º—É –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º —Å—Ç–∞–≤–∏–º–æ ENG
      ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'ENG', message: 'DB_REQUEST_ERROR' }));
    }

    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –º–∞—î –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
    if (!user) {
      // –°—Ç–≤–æ—Ä—é—î–º–æ –Ω–æ–≤–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–≤ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
      try {
        await this.userService.createUser({ chatId, telegramName: first_name || username });
      } catch (error) {
        // –Ø–∫—â–æ —â–æ—Å—å –ø—ñ–¥–µ –Ω–µ —Ç–∞–∫, —Ç–æ –º–∏ –æ–ø–∏–Ω–∏–º–æ—Å—è —Ç—É—Ç
        ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'ENG', message: 'DB_REQUEST_ERROR' }));

        // –î–∞–ª—ñ –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏–º–æ, –æ—Å–∫—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ–≤–∏–Ω–µ–Ω –ø–æ—á–∞—Ç–∏ –≤—Å–µ —Å–ø–æ—á–∞—Ç–∫—É
        return;
      }

      // –§–æ—Ä–º—É—î–º–æ –Ω–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —é–∑–µ—Ä—É —ñ–∑ –æ–∫—Ä–µ–º–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤, –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç—ñ
      let messageToUser = this.telegramUtilsService.setBotMessage({
        lang: 'UA',
        message: 'SUCCESS_USER_CREATE',
      });
      messageToUser += `${this.telegramUtilsService.setBotMessage({
        lang: 'UA',
        message: 'YOUR_CHATID',
      })}${chatId}\n`;
      messageToUser += `${this.telegramUtilsService.setBotMessage({
        lang: 'UA',
        message: 'YOUR_NAME',
      })}${first_name || username}\n`;

      // –ë–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö,
      // –æ—Å–∫—ñ–ª—å–∫–∏ —è–∫—â–æ –º–∏ –¥—ñ–π—à–ª–∏ —Å—é–¥–∏, —Ç–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö!
      try {
        ctx.reply(messageToUser);
      } catch (error) {
        console.log('[Error send message] ::: ', error);
      }
    }
    // –û–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π –≤–∂–µ —î –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
    else {
      const { chatId, telegramName } = user;

      // –§–æ—Ä–º—É—î–º–æ –Ω–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —é–∑–µ—Ä—É —ñ–∑ –æ–∫—Ä–µ–º–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤, –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç—ñ
      let messageToUser = this.telegramUtilsService.setBotMessage({
        lang: 'UA',
        message: 'RETRIVED_USER_PROFILE',
      });
      messageToUser += `${this.telegramUtilsService.setBotMessage({
        lang: 'UA',
        message: 'YOUR_CHATID',
      })}${chatId}\n`;
      messageToUser += `${this.telegramUtilsService.setBotMessage({
        lang: 'UA',
        message: 'YOUR_NAME',
      })}${telegramName}\n`;

      // –ë–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
      try {
        ctx.reply(messageToUser);
      } catch (error) {
        console.log('[Error send message] ::: ', error);
      }
    }
  }

  async setLanguage(ctx) {
    // –°–∞–º–æ —Å–æ–±–æ—é, –≤ –ø–µ—Ä—à—É —á–µ—Ä–≥—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —á–∏ —î —É –Ω–∞—Å –ë–î —Ç–∞–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
    const { id: chatId } = ctx?.update?.message?.chat;
    let user: null | User = null;

    try {
      user = await this.userService.getUser({ chatId });
    } catch (error) {
      ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'ENG', message: 'DB_REQUEST_ERROR' }));

      return;
    }

    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –º–∞—î, –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –Ω—ñ–∫–æ–º—É –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –º–æ–≤—É
    if (!user) {
      try {
        ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'UA', message: 'USER_NOT_FOUND' }));
      } catch (error) {
        console.log('[Error send message] ::: ', error);
      }

      // –©–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫–∏–π –ø—ñ–¥—Ö—ñ–¥ –±–µ–∑ —Å–µ–∫—Ü—ñ—ó else
      // –ø—Ä–æ—Å—Ç–æ –∑–∞—Ä–µ—Ç—å–æ—Ä–Ω–∏—Ç–∏ –ø–æ–¥–∞–ª—å—à–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É
      return;
    }

    // –í—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ —Ç—É—Ç –±—É–¥—É—Ç—å –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞, —è–∫–∏–π —Ç–æ—á–Ω–æ —î —É –Ω–∞—Å –≤ –ë–î
    // –°—Ç–≤–æ—Ä—î–º–æ –∫–Ω–æ–ø–∫–∏, –º–∞—Å–∏–≤ –º–∞—Å–∏–≤—ñ–≤
    const keyboard = [
      [Markup.button.callback('–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ üá∫üá¶', `${TELEGRAM_BOT_BTN_ACTIONS.SET_LANG}lang=UA`)],
      [Markup.button.callback('English üá∫üá∏', `${TELEGRAM_BOT_BTN_ACTIONS.SET_LANG}lang=ENG`)],
    ];

    // –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —ó—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
    try {
      await ctx.reply(
        // –ø–µ—Ä—à–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä - —Ü–µ —Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        this.telegramUtilsService.setBotMessage({ lang: 'UA', message: 'SET_LANGUAGE' }),
        // –¥—Ä—É–≥–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä inlineKeyboard
        Markup.inlineKeyboard(keyboard),
      );
    } catch (error) {
      console.log('[send keyboard setLanguage]', error.message);
    }
  }

  async sendUserDataToGoogleSheets(ctx) {
    // –î—ñ—Å—Ç–∞—î–º–æ chatId –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    // –°–∞–º–æ —Å–æ–±–æ—é, –≤ –ø–µ—Ä—à—É —á–µ—Ä–≥—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —á–∏ —î —É –Ω–∞—Å –ë–î —Ç–∞–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
    const { id: chatId } = ctx?.update?.message?.chat;
    let user: null | User = null;

    try {
      user = await this.userService.getUser({ chatId });
    } catch (error) {
      ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'ENG', message: 'DB_REQUEST_ERROR' }));

      return;
    }

    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –º–∞—î
    if (!user) {
      try {
        ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'UA', message: 'USER_NOT_FOUND' }));
      } catch (error) {
        console.log('[Error send message] ::: ', error);
      }

      // –ó–∞–∫—ñ–Ω—á—É—î–º–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–∞–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É
      return;
    }

    // –¢—É—Ç —É –Ω–∞—Å —Ç–æ—á–Ω–æ —î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
    // –¥—ñ—Å—Ç–∞—î–º–æ –π–æ–≥–æ –¥–∞–Ω—ñ
    const { telegramName, phone, language, location } = user;

    try {
      // URL –¥–æ –Ω–∞—à–æ—ó –∞–ø–ø –≤ –ì—É–≥–ª –¢–∞–±–ª–∏—Ü—ñ –≤–∏–Ω–æ—Å–∏–º–æ –≤ env
      // –¥–ª—è –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—è
      const { status } = await axios.post(`${process.env.GOOGLE_SHEETS_APP_URL}`, {
        // –Ø–∫ –ø–∞–º'—è—Ç–∞—î—Ç–µ –≤ —Å–∫—Ä–∏–ø—Ç—ñ –ì—É–≥–ª —Ç–∞–±–ª–∏—Ü—ñ –º–∏ –æ—á—ñ–∫—É—î–º–æ userData
        // –¶–µ –º–∞—Å–∏–≤ –∑–Ω–∞—á–µ–Ω—å, –∫–æ–∂–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω–Ω—è –æ–∫—Ä–µ–º–∞ –∫–æ–ª–æ–Ω–∫–∞
        userData: [telegramName, phone, language, location],
      });

      // –Ø–∫—â–æ –º–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —Å—Ç–∞—Ç—É—Å !== 200, –∞ –º–∏ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö –≤–∫–∞–∑–∞–ª–∏ 400-–π —É —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏
      // –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –ø—Ä–æ —Ü–µ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —Å–ø–æ–≤—ñ—Å—Ç–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
      if (status !== 200) {
        return await ctx.reply(
          this.telegramUtilsService.setBotMessage({ lang: language, message: 'ERROR_ADD_DATA_TO_GOOGLE_SHEETS' }),
        );
      }

      // –ù—É —ñ —Ç—É—Ç –º–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —É—Å–ø—ñ—Ö —ñ —Ç–∞–∫–æ–∂ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ —Ü–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
      await ctx.reply(
        this.telegramUtilsService.setBotMessage({ lang: language, message: 'SUCCESS_POST_TO_GOOGLE_SHEETS' }),
      );
    } catch (error) {
      console.log('[error]', error);

      // –£ –≤–∏–ø–∞–¥–∫—É –∞–∫—Å—ñ–æ—Å –ø–æ–º–∏–ª–∫–∏ –∑–∞–ø–∏—Ç—É
      // —Ç–∞–∫–æ–∂ —Å–ø–æ–≤—ñ—â–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
      return await ctx.reply(
        this.telegramUtilsService.setBotMessage({ lang: language, message: 'ERROR_ADD_DATA_TO_GOOGLE_SHEETS' }),
      );
    }
  }

  async getDataFromGoogleSheets(ctx) {
    // –î—ñ—Å—Ç–∞—î–º–æ chatId –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    // –°–∞–º–æ —Å–æ–±–æ—é, –≤ –ø–µ—Ä—à—É —á–µ—Ä–≥—É –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —á–∏ —î —É –Ω–∞—Å –ë–î —Ç–∞–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
    // —Ä–∞–∑–æ–º —ñ–∑ —Ç–∏–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–¥–±–∞—á–∏—Ç–∏ —á–∏ —î —É —Ç–∞–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–æ—Å—Ç—É–ø –¥–æ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
    const { id: chatId } = ctx?.update?.message?.chat;
    let user: null | User = null;

    try {
      user = await this.userService.getUser({ chatId });
    } catch (error) {
      ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'ENG', message: 'DB_REQUEST_ERROR' }));

      return;
    }

    // –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –º–∞—î
    if (!user) {
      try {
        ctx.reply(this.telegramUtilsService.setBotMessage({ lang: 'UA', message: 'USER_NOT_FOUND' }));
      } catch (error) {
        console.log('[Error send message] ::: ', error);
      }

      // –ó–∞–∫—ñ–Ω—á—É—î–º–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–∞–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É
      return;
    }

    // –¢—É—Ç —É –Ω–∞—Å —Ç–æ—á–Ω–æ —î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
    // –¥—ñ—Å—Ç–∞—î–º–æ –π–æ–≥–æ –¥–∞–Ω—ñ
    const { language } = user;
    let googleData = null;

    try {
      // –î–æ –Ω–∞—à–æ–≥–æ URL –¥–æ–¥–∞—î–º–æ –∫–≤–µ—Ä—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä sheetName
      // —ñ –ø—ñ–¥—Å—Ç–∞–≤–ª—î–º–æ –Ω–∞–∑–≤—É –õ–∏—Å—Ç–∞ —ñ–∑ —è–∫–æ–≥–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∑—á–∏—Ç–∞—Ç–∏ –¥–∞–Ω—ñ
      const { data, status } = await axios.get(`${process.env.GOOGLE_SHEETS_APP_URL}?sheetName=Sheet1`);

      // –¶–µ —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Ç—É –≤ —Å–∞–º–æ–º—É –∞–∫—Å—ñ–æ—Å
      if (status !== 200) {
        return await ctx.reply(
          this.telegramUtilsService.setBotMessage({ lang: language, message: 'ERROR_GET_DATA_TO_GOOGLE_SHEETS' }),
        );
      }

      const { status: GoogleScriptStatus, data: GoogleSheetData } = data;

      // –¶–µ —Å—Ç–∞—Ç—É—Å, —è–∫–∏–π –º–∏ –ø—Ä–æ–ø–∏—Å–∞–ª–∏ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö –≤ –ì—É–≥–ª –¢–∞–±–ª–∏—Ü—ñ
      if (GoogleScriptStatus !== 200) {
        return await ctx.reply(
          this.telegramUtilsService.setBotMessage({ lang: language, message: 'ERROR_GET_DATA_TO_GOOGLE_SHEETS' }),
        );
      }

      googleData = GoogleSheetData;
    } catch (error) {
      return await ctx.reply(
        this.telegramUtilsService.setBotMessage({ lang: language, message: 'ERROR_GET_DATA_TO_GOOGLE_SHEETS' }),
      );
    }

    if (!googleData) {
      try {
        await ctx.reply(
          this.telegramUtilsService.setBotMessage({ lang: language, message: 'ERROR_GET_DATA_TO_GOOGLE_SHEETS' }),
        );
      } catch (error) {
        console.log('sendMessage', error);
      }

      // –ó–∞–≤–µ—Ä—à—É—î–º–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É, –æ—Å–∫—ñ–ª—å–∫–∏ –¥–∞–Ω–∏—Ö –º–∏ –Ω–µ –æ—Ç—Ä–∏–º–∞–ª–∏
      return;
    }

    // –¢—É—Ç —É –Ω–∞—Å —Ç–æ—á–Ω–æ —î –¥–∞–Ω—ñ —è–∫—ñ –º–∏ –º–æ–∂–µ–º–æ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
    // –£ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–∏—Ö–æ–¥–∏—Ç—å –º–∞—Å–∏–≤ –º–∞—Å–∏–≤—ñ–≤
    // –¥–µ –∫–æ–∂–µ–Ω –≤–∫–ª–∞–¥–µ–Ω–∏–π –º–∞—Å–∏–≤, —Ç–æ –æ–∫—Ä–µ–º–∏–π —Ä—è–¥–æ–∫ —ñ–∑ —Ç–∞–±–ª–∏—Ü—ñ
    const [messageToUser] = googleData.map((tableRow) => tableRow.join(', '));

    try {
      await ctx.reply(messageToUser, { parse_mode: 'HTML' });
    } catch (error) {
      console.log('sendMessage', error);
    }
  }
}
